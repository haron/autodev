#cloud-config
users:
  - name: dev
    groups: [sudo]
    shell: /bin/bash
    sudo: "ALL=(ALL) NOPASSWD:ALL"
    ssh_authorized_keys:
      - https://github.com/haron.keys

package_update: true
package_upgrade: false

packages:
  - git
  - tailscale
  - ripgrep
  - mosh
  - curl
  - moreutils
  - python3
  - tmux
  - htop
  - vim
  - neovim
  - lua-check
  - stow
  - fzf
  - fd-find
  - gh
  - pdsh
  - ansible
  - bat
  - unzip

write_files:
  - path: /home/dev/.bash_profile
    owner: dev:dev
    content: |
      if [[ -z "$TMUX" ]]; then
          tmux attach -t main 2>/dev/null || tmux new -s main
      fi
      [[ -f ~/.bashrc ]] && source ~/.bashrc
  
  - path: /home/dev/.claude/settings.json
    owner: dev:dev
    content: |
      {
        "hooks": {
          "PreToolUse": [{
            "matcher": "AskUserQuestion",
            "hooks": [{
              "type": "command",
              "command": "~/telegram.py question"
            }]
          }]
        }
      }

runcmd:
  - [ sh, -c, "curl -LsSf https://astral.sh/uv/install.sh | sh" ]
  - [ sh, -c, "curl -fsSL https://claude.ai/install.sh | bash" ]
